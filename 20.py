s = '''Tile 3623:
.##...#.#.
..##..#...
#......#.#
#.#..#.#..
##......#.
......#..#
###...#.#.
#.#.#.#.#.
......####
#####....#

Tile 1301:
.#..###..#
.##..##..#
#.......#.
###...###.
##.#..#.##
.#.##.##..
#.#####.##
#..##.....
#......#..
...#...#..

Tile 3089:
######.##.
.#...#..##
#.#.##.#.#
#....#....
#.....#..#
#.##..#..#
.##..#..#.
#.##...##.
#..#.###..
#.###.#..#

Tile 3217:
#.######..
...#.#...#
.#.#..#...
#.#.##...#
#..#..#...
...#......
..#..#.###
#.#...##..
#...#..#..
..##.##..#

Tile 3203:
.##...#..#
#...##...#
#....#....
#.###....#
#.##......
.....#.#..
....#....#
#..#.....#
#......#.#
##.#.###..

Tile 3467:
.#....#.#.
...###...#
#...#.####
..###.#..#
.....####.
#...##.##.
##.#.#.#..
##....#..#
##......#.
#####..###

Tile 1013:
#.....##..
.#..#..###
##....#.#.
#.#.##.#.#
###....#..
#...#..#..
#.##....#.
...#......
.......#..
.##.#..#..

Tile 2843:
.##.#...##
#.###.#...
#....##.#.
#...###.#.
.#..#.....
.....##...
###.##..#.
...#..#...
#.#....#..
#.####..#.

Tile 1549:
###...#...
.#.##....#
.......#..
#.###...##
##..#..#..
.#.#......
#.####...#
#.##....##
#.......#.
#.#.###.#.

Tile 2591:
######.#.#
.###.....#
#..####.##
#..#..#..#
...#.#.##.
...###....
.#...#..#.
.##....#..
...##....#
##...#....

Tile 2897:
###..##.#.
...#..##..
..........
.....#...#
....###..#
...#.#...#
#..###.#..
.....#...#
#....#....
...#####..

Tile 3433:
##...#....
#.##.....#
..##...##.
#..##...#.
#..#.#..##
#.#....#..
....##...#
#..#......
###.#.....
.#.#.#..##

Tile 1153:
#.#.##..##
##..###...
#..#.....#
....#.#.##
.#.#...#..
#....#...#
.#.....#..
#..#..###.
..#.#.##.#
##...##...

Tile 1223:
.#..###.#.
.....#.#..
....#....#
..#.......
##.###...#
..#.#.#..#
.##.......
.##......#
#........#
......#...

Tile 1579:
.##.####.#
..........
..........
.........#
##..#..#..
#.##....#.
##...#....
#..#.#...#
..##.#...#
###..#..#.

Tile 2687:
#..#.#....
##...#....
#...#.##..
.....#..#.
#.........
#...#....#
#....#...#
..........
##.....###
###..#.###

Tile 3881:
..##..###.
##.#...#.#
..#....#.#
##........
#........#
#........#
#..#...###
#.##.#.#..
.....#..##
###...#.##

Tile 3169:
...#.#####
#.........
.......##.
.#..#.#...
#.......#.
...##....#
#.#.#.#..#
...#.#....
#.......##
.....##.##

Tile 1973:
##..###...
.#.#.##...
#......#..
#...#...##
#..#.#..#.
#.#.#..#.#
.......##.
.#.....#.#
...#..###.
##.#.#..#.

Tile 3581:
####.###..
..#......#
..##.....#
.#.####...
...#..#.#.
....#....#
.#.....#..
###.#.#...
#......###
##...#...#

Tile 1723:
..####...#
##........
......#..#
...#...#.#
#.##.#..##
#.....##.#
..#......#
..........
...#.#...#
#..#.##.#.

Tile 2539:
#.##.#..##
#....#...#
#.##..#.##
......##..
.....#..##
#....#...#
......#..#
###.###..#
......#...
..#.##..##

Tile 2531:
....##.##.
#..#.#..#.
....#....#
...##.#..#
.##..#..#.
.#....###.
#.####.#.#
....#..#.#
###..##.##
.#...##..#

Tile 3917:
#.#...#...
#.#.......
.#.##.#...
.##...#...
..##.##.##
#.....#...
#...#...#.
#.##.....#
..#..#..#.
#..##....#

Tile 1489:
..#..#.###
#...#####.
....##...#
.#.##.##.#
.####....#
...#...###
..........
#..##.#.#.
##..#.#.#.
#.##...###

Tile 1669:
##.##.###.
...#....##
#.#.....##
..#....#.#
.#.#...#..
####.##...
#..###..#.
#..##...##
#.#.#.....
######.#.#

Tile 2549:
###.#.....
......#.#.
#.#...#..#
#....##...
...#...#.#
##.......#
##...#...#
......#..#
#.....#.##
..#.#...#.

Tile 3797:
.#####...#
#..##.#..#
##.###.#..
##..##....
..####....
...#...#.#
##..#.##.#
....#....#
.####.#...
.....##.#.

Tile 2137:
#.#..#.###
..##....##
....##...#
##.#..#...
.##.##.###
##...#.#.#
#.....#.#.
..#..#...#
##..#.###.
#...##.##.

Tile 2087:
#.#...##..
..###.....
##.#....#.
#........#
..#.#..#.#
.#..#...##
.##......#
...#..#..#
#.#..#....
######..##

Tile 3929:
...##.#.#.
..#..#...#
.#.###....
.##.......
...##.#.##
#...###.#.
#.##.#....
#.#....##.
.........#
.###.#####

Tile 1907:
#.###.#.#.
#........#
##.#.##..#
...#...##.
##.#....#.
.....#..#.
.###...##.
.#.......#
.#...###..
#..#.#.##.

Tile 3923:
..#..##...
........#.
#....###..
.........#
...#.###..
#...####.#
..##...#..
.##......#
#.....#...
.#.....#.#

Tile 2833:
###.#.##.#
#..###...#
##..#.....
#..##.#...
..#..#.#.#
..##.....#
#........#
#...#.#...
##..#...#.
.#########

Tile 2143:
#.##.##..#
#..#.##..#
..#....#.#
##.#.#...#
....#...#.
#.........
##...#.##.
#.##.###.#
....##...#
#...##.#.#

Tile 2039:
#.##..##..
....##.#..
#...#.##.#
##.#.#....
.......#..
#.##....##
.#..##.#..
...##.....
#...#....#
##....#.#.

Tile 3943:
#.#..#.#..
##..#...##
...#.#...#
.###.#.##.
..#...#.##
....#..###
#..#...#..
#..#.##.##
##.###...#
##...#####

Tile 1697:
.#..#####.
#....####.
.#.#.....#
.........#
..#......#
.#.#.....#
#..##.##..
##.#....#.
.##..#....
#.##.#####

Tile 1621:
..#.###..#
...###..#.
..........
#........#
##........
#.##....#.
#...#.....
....#.#..#
#.........
.###.###..

Tile 2683:
#..######.
.#......#.
....#.#..#
##......#.
...#.....#
......#..#
##.......#
.#...#.###
###.#....#
##.###.#.#

Tile 2203:
##..##...#
..#..#...#
##...#....
##..##....
#...###..#
...#..#.##
#.....##.#
..#...#..#
###....#..
####.#..#.

Tile 3469:
###...##.#
#.#..#####
..#.#.#..#
#..#......
#...#....#
##....#..#
#...##....
.#.#.###..
..#..##.#.
..##.#.#.#

Tile 1801:
..#....#.#
#...#..#..
.#..#....#
##..#.#.#.
##.###.#.#
..##..#...
##..##....
..#...####
#.#.....#.
.#.......#

Tile 3373:
#.#..#..#.
....##.#..
#......###
#....###.#
##.#.#####
#..#...##.
#.##....#.
.##.....#.
......#...
##..##.##.

Tile 2237:
.###.#....
..#..##..#
#.#.##.#..
#.#.##..#.
...#..#..#
#.##...#..
####...###
#..#.....#
..#.....##
###..#..##

Tile 2221:
#.###.....
...##.....
..#.#.....
#..##.....
......#.##
.....#.#..
.#.#.....#
....###...
#....#.##.
##.#####.#

Tile 2927:
#.###...##
......##..
.......###
##....##.#
..#...#...
..#...#.##
#..#...#..
.........#
.#..#...##
.####.#.#.

Tile 1861:
.#.#...#..
..#.......
##.....#..
#....#....
##..#....#
.##.#.##.#
....##..##
##.#....#.
#.....###.
#..#.....#

Tile 1097:
#......#.#
#....##..#
###.#..###
...#......
..#....#.#
#...#.....
##..##.#.#
###...##..
#..##...##
..###....#

Tile 3331:
#..##.#..#
#.###.##.#
.#.##...#.
...#.##..#
.........#
......##..
#..#.....#
..#....###
...#.....#
.##.#.##.#

Tile 1033:
#.##..#.##
..#.......
...#...#..
....##.###
##.####..#
#.#.##.##.
.#..#..#..
.........#
#.#.......
##.####..#

Tile 1933:
..##....##
#...#.##.#
##....####
......#.#.
......###.
#...#..###
#...#.....
......##..
......#..#
#....###..

Tile 1483:
#.###....#
#.###...##
..........
..#.#.#..#
........##
....#.....
#.##.#...#
....##....
....#.##..
....#..#..

Tile 3823:
#.###.###.
.##..#.##.
#...#..#..
#.##....#.
....#.....
###.####.#
.#.##.#.##
...##..#..
#..#.#..#.
..#.##..#.

Tile 1759:
#..##...#.
.####..###
#.#......#
.##...#..#
##........
##......##
#..##....#
..#...##..
#......#.#
####.#..##

Tile 1187:
.##.#..###
....##....
##.#......
#..##....#
#.#.#.#.#.
..#.###...
....##...#
..##.#..##
#.#...#...
..#.##..##

Tile 2857:
..#.....#.
..#..##..#
##.#..#..#
..#..###.#
#........#
...##....#
#...#...#.
##.....#.#
##...##...
#.#..#....

Tile 1811:
.#.######.
#.......#.
....#..###
##.....#..
###....#..
..#.#..##.
#....#..##
#......##.
#.#....##.
...#...###

Tile 1511:
##.#.#####
.....#..##
#....#.#.#
..#..##..#
#.......#.
#..##....#
###.#.##.#
#.......##
###...#.#.
.##....#..

Tile 2999:
#####.####
##.......#
..#...#.#.
.....#.##.
.....#..#.
.......###
#.....#...
#....#....
#...####..
###.#...##

Tile 3209:
..#####...
#.#.#....#
#...#...##
##........
.....##.#.
#..##.....
..#.#.##.#
##..##...#
#.#......#
#..#.#.#..

Tile 2273:
#####..#.#
...###...#
#..##....#
#......#.#
..##.....#
##.....#.#
#..#..#.##
#...##....
........#.
##.#.####.

Tile 1583:
#.###.##..
.#.#.#.#..
........##
...##...#.
##..#.#..#
...#.....#
#........#
.....##...
######.###
#.#..#.#.#

Tile 1787:
###.#####.
#...#.#..#
#........#
.#..##....
...#..#..#
#.#...#...
#....#....
.#....#..#
#.#.#....#
####.#.#.#

Tile 3323:
###..##...
#.....##..
#...###...
##..##..##
#..#.#.#.#
.......##.
#...#....#
.....#.#..
..#.#..#..
#.##.###..

Tile 1429:
...##..#.#
..........
....#..#.#
.........#
.#.......#
.##....#..
...#.#..#.
.#.#..#..#
####.##...
#.#######.

Tile 3221:
...#..#..#
#..#..##..
....###.#.
######...#
....#..#..
#....#.#..
###..#...#
.........#
#....##..#
###.#.###.

Tile 3299:
###.###..#
...#.#.##.
#...##....
.....#..#.
...#.....#
#.#.......
#....#..#.
.#.#.....#
...#.....#
.##...####

Tile 1741:
#..##.##.#
.##..#..##
#.###..##.
#.......#.
##.....#.#
#..#.#....
##.#..##..
####.##.##
#........#
.###.#...#

Tile 1063:
##.##...#.
.#..##....
...#...#..
#.#.....##
.##....#..
#.#.#.....
####.#..##
.#.##.....
.#.##....#
#.#..##.#.

Tile 2381:
...####.##
#.#.##...#
....#.....
.#..#.##.#
##.###.#..
###......#
#.....#...
##.####...
..#...####
#.####.##.

Tile 3463:
.###.#.#..
####.#.###
.#..#.....
##........
#.##...#.#
.#........
#...#...#.
......#..#
##.#..#...
..#..#..##

Tile 2063:
#..#.#.###
#.##.....#
..#....#..
.#...#..##
.####...##
##..##.#..
.........#
..##......
#....#...#
...##...#.

Tile 1487:
##..##.###
#........#
....#....#
.....#..##
#....#....
#.#...#.#.
#....#.#..
.#..##...#
.#...#.#.#
#..####.#.

Tile 2243:
.#..#.#.#.
###...#...
...##.....
.#...###..
.#.#..##..
#..###..##
..#..##.##
..##.....#
....#.#...
.....#####

Tile 1657:
##...#.#..
#...####..
#...##.#..
......#.##
..#.....##
###....###
##.#.##...
.#.#...#..
#........#
..####.###

Tile 2081:
########..
#.#.#...##
#.#...#...
###.#.#.#.
#.......#.
...#.#....
##........
#.##.#..#.
#.###.....
..#.#.###.

Tile 2287:
######..##
#......#..
....#.....
#..#.#....
##...#....
#..#....##
#....#....
#.........
#..#....#.
......###.

Tile 1181:
.####.##.#
..#....###
#.........
.....#....
.##..#.##.
#####..#..
...#..###.
##...#.#..
#..#.##...
..#.#....#

Tile 3041:
##..#.####
#..#....#.
#.#..#..#.
#....#...#
#........#
#.....#...
##..#.....
..####..#.
..##....##
.#.####.##

Tile 1319:
###.#...##
##....#...
.....##.##
...#.###.#
#......#..
##..#.....
##...##.#.
...#...#..
#.###.#.#.
.######...

Tile 3271:
...##.####
#.......#.
.#........
#......#.#
..#..#..##
#.##.....#
...#..#.#.
.####..###
.....##..#
.#.##..##.

Tile 1279:
#..#.#.#..
#.##..#..#
##....#..#
..#.#....#
#.#...#...
.##....#..
###.#....#
....#...#.
.#....#.#.
########..

Tile 2029:
.#.....#.#
##.#.....#
..##....#.
.#.###.#..
.#....#.#.
#........#
.......###
#......##.
..#.#.#...
#..#..#.##

Tile 3361:
###.#.#.#.
...#...#..
#.#.#....#
#.......#.
....#..##.
#.##....##
..##..#.##
#..#...#.#
..#...#..#
..##.##..#

Tile 3889:
####.##.#.
#..#....#.
...##....#
#...#...#.
..#......#
..####...#
#.#..####.
##.......#
...#...#.#
#.#...##.#

Tile 2459:
...#.#.#.#
..#......#
...##.#...
.#..##...#
.#...#..##
.#....#..#
##.......#
##.#......
#.#.#.##.#
##..#.###.

Tile 1951:
.#.###.###
...#.#.###
#.......#.
..##.....#
...#...#..
#.#..##...
#.##......
#..#.###..
...###...#
#.....####

Tile 1627:
#.##......
#.#..#.#..
.##.......
.###....##
##..#..#..
..#....#.#
.##..#....
##.#.#....
##.......#
.##.#.#..#

Tile 1297:
##.#...#..
#....#.#.#
.......#..
##......#.
#...#.....
#........#
.....#.#.#
.#....#.#.
#..#..#..#
########.#

Tile 3989:
...#......
....#...#.
###.......
.#...###.#
##.#......
.#..#....#
.#...#.#.#
..#####..#
##....##.#
.#.#...###

Tile 3779:
#.#.##.#..
#.#......#
...#.....#
.#...#.#..
...##.#...
#..#..##.#
#....##...
###.#....#
.##..##..#
...##....#

Tile 3769:
....#..#..
##.#....#.
.#.##..#.#
#.##.#..##
....#.##..
#.....##..
#....##.#.
#.#.###.#.
##.#.###.#
.#...##...

Tile 3803:
#..#######
.#..###...
..#..#.###
##..#.#...
.###.....#
##........
#######...
#.#.##....
....#....#
##....#.#.

Tile 1777:
..#.##.##.
#.....#..#
....#..##.
..#..#...#
#....###.#
#....#..#.
.........#
#.....#..#
#.....#.#.
##.###..##

Tile 1663:
#.##..###.
#..#.#...#
.....#...#
..##.##...
#..##.....
#...#..#.#
#...#.#...
##.#.#...#
#.####...#
......#..#

Tile 3329:
..##.#...#
.#........
..##..##..
#...##.###
#.#.#..#.#
#..#.#...#
.....#.###
.##..#.#.#
.###..##..
#####....#

Tile 1459:
.#.....###
..........
#....#....
........#.
...##..###
...#......
.#..#.##.#
..#..#.###
#.#......#
.#.#...###

Tile 3343:
.##.##....
.##.#.####
#..#..#.#.
#.###....#
..#..#....
#.......##
#.#....##.
#........#
...#...#.#
...##...##

Tile 3793:
##.##....#
..##.....#
#..#..##.#
#...###.##
##........
#......#.#
.##....#..
#.#.#.....
...#....#.
#...##.###

Tile 3527:
###.#....#
#.#.##.#..
.#...#....
.........#
#......#.#
#.......##
...#.#....
....#...#.
#.....#.##
.#.######.

Tile 1721:
.###.#..##
#.###....#
#.#.#....#
##.#....#.
#.#...#..#
.#..#####.
##.#......
..#.###.#.
#......#.#
#.##....#.

Tile 2357:
##.##.#..#
..#.....#.
...#.#....
##.......#
#.#.#..#.#
#.#...#.##
##.....#..
#.....#...
#..##.....
#..######.

Tile 2207:
.##...###.
##..#.#.##
##..###..#
..#.###.##
...###...#
#..#.....#
.#.###....
.#..#.#...
#####...#.
.#...#...#

Tile 2633:
##.#.....#
.....#..##
......#.##
#........#
...###....
..#.#..#.#
#....#...#
##...#..#.
.#..#..###
######.##.

Tile 3253:
##...#.#..
.##.###.#.
#.......#.
....###..#
##.#..#...
...#.....#
#.....##.#
....#.....
##..##.#..
##..##.#.#

Tile 2293:
#.#..#...#
#.......##
#.#.#....#
#...##.##.
#.##.#....
#..#.#....
#.#.......
#........#
#........#
.#.#......

Tile 2671:
##.#.#...#
..##...#..
####...#..
##....#...
#...#....#
.....#..#.
.#.#..#.##
###.####.#
#.####.#.#
###.###.#.

Tile 3119:
........#.
...##...#.
#.#....##.
.#...#....
...#...##.
.###..#..#
.........#
#.#....#..
.#.......#
##......#.

Tile 3413:
.......#.#
##...#...#
......###.
#.#.......
##.#.....#
#..#....##
##..#...#.
..#.#.####
.#.....#.#
.....####.

Tile 2969:
...######.
.#.#....#.
#.#....#.#
....###.##
.....#.#..
..###..#.#
#.##....#.
..###.#...
..#.......
.......#.#

Tile 2713:
..#.#.#...
...#......
.....#....
.###.#...#
#..#......
#.#.###..#
#...##..##
###....##.
...#.##.#.
##..#..#.#

Tile 2749:
#.....#..#
.##.#...##
#..#....#.
..##..#...
.#..##...#
###..#...#
..#....#.#
#...##.###
#..#.....#
#.##..#...

Tile 1117:
...#..##.#
.....##...
...#.#..##
#.#.#....#
#.#...#...
.#######..
.#.#..###.
#...#.##.#
##....#...
..####..##

Tile 3517:
########.#
###..#.###
#.........
.#.....###
##...#...#
.#..#..#..
.##.####.#
......#..#
.....##..#
...#...#.#

Tile 1523:
#..####.#.
.#.....#..
#.#.......
....#.....
.....####.
#.#....##.
.#.....##.
.#..#.....
..#...#..#
###...####

Tile 2879:
.##...#...
##....####
..###...#.
.###.##..#
....##....
...##.....
##.#.#.#.#
#.#....##.
#..#......
###..#####

Tile 3851:
##.#.#.#.#
......##..
#....##.#.
##...#....
#..#..#.#.
....#####.
###.##...#
#...###.#.
#........#
.#..#..##.

Tile 2659:
##...####.
.........#
.###..#.##
#...###.#.
#.##.....#
#####...##
..#......#
##.#......
##...##...
#.....####

Tile 1171:
#.....#.##
.#...#....
.#...#...#
#...#...#.
#....#...#
....#...#.
.#..#.#.##
#....#.#.#
.#...#...#
##.......#

Tile 2711:
....#.###.
#....#.###
#..#..#.##
......#.#.
.#.#......
#.#....#.#
#.......##
...#......
.....#.#.#
......#..#

Tile 1543:
#..#..###.
..#.......
...#.#.#.#
#..#....#.
#.#.#....#
.##....###
..#..#...#
..#.#...#.
...#..#...
#####..##.

Tile 3163:
#.#.#.##..
........#.
..##.###..
#..#...#..
..#.#..#..
#.....###.
.#........
......#.#.
..#.#..#..
#.##.#...#

Tile 1249:
#....###.#
..#.###...
##...#..##
.#..#...#.
#.#.......
#......#.#
#.......##
..........
#........#
.##.###.#.

Tile 2003:
#.#..#..##
#..#.....#
#...#.##..
...###.##.
..#.#.....
#.##...#..
........##
###.#.#..#
.#.....#..
#.##.#.#..

Tile 2129:
#.....##..
.#...#...#
...#.....#
.....#.#.#
...##.#...
#.........
...#.#...#
.....##.##
...#..#..#
.####.#..#

Tile 3391:
.#.#...#..
#..#..#...
......#..#
#..#.#.#..
.#...##..#
#.#..#...#
....#....#
#.....#.##
#........#
..##..####

Tile 1867:
.##..##.##
....#...#.
##.#..#...
..##......
###.....#.
#........#
##.#...#.#
.#.#..##..
#.#...#...
##......#.

Tile 1747:
###..##.##
#...#.#.#.
..##......
#..####...
.#.###.##.
#......#.#
#...#.....
...##....#
.#.#......
#.#...##..

Tile 3191:
#...#...#.
..###.....
#.##.#....
.##...#...
#.###.##..
##.##..###
.###..####
#....#..#.
.....#....
.##.####..

Tile 3511:
.##.##.###
#.#.#.##.#
....#...##
....#...#.
#.##.#.#..
##...##..#
#.#....#.#
#.#...#...
..........
....#.#.#.

Tile 2657:
####..##.#
.#..#...##
....#.##.#
.......#..
#.#..#....
.#.#..#.##
######....
.....##..#
...#..##.#
#.#.####.#

Tile 3697:
#####.#..#
#.##.#..#.
##.##..#..
#.#.##..#.
##.####..#
.###.....#
.#....##.#
..#.##..#.
#.........
##..###.#.

Tile 1123:
.....#...#
#.......##
##.#..##.#
..........
..##......
...#..##.#
####.....#
.##......#
##........
.#.......#

Tile 2729:
.##....###
#...###.#.
###.#...##
#.##...#..
##......##
....#...##
#.....#...
#.##..###.
....#.#...
#..####.##

Tile 3533:
..#.##..#.
..##.#...#
#....##..#
#.....##..
#.....#..#
..........
#..#..##..
#.....##..
.#..##...#
.##.#.#.#.

Tile 3919:
#...#.....
#....###..
.....###..
##...#...#
.#..##....
..##...#.#
.........#
..#.###...
##........
####.##...

Tile 1453:
#.....##.#
#.......#.
.#.#..#.##
#....#...#
......##..
....#....#
..#..#..##
##..#.##.#
#....##...
#####.##.#

Tile 3643:
..#.#.####
.........#
#...#.##.#
...##...##
.#......##
#.#....#..
.#........
#.#.#....#
####.....#
###.####..

Tile 2767:
.##..####.
...#...#..
..#......#
....#.####
.#.#..#.#.
#.....#.#.
##..#...#.
#.###.#...
#...##...#
...##.#.#.

Tile 3541:
##.##...##
#.....##.#
#........#
.#..##....
#......#..
......#..#
#....#..#.
.#.#.#.#..
###..#..#.
#.######..

Tile 3617:
###..#....
#..#......
.......##.
....#...##
#...#..#..
.#..#...#.
#..#.#..#.
.........#
#...#..#.#
#..#.#..#.

Tile 1229:
.#...#.##.
.......#..
#.#.#.#.##
###..#...#
#.#..#...#
...##.#..#
.#.#......
#....#...#
#..#..####
#.##..###.

Tile 1259:
#..##.####
.........#
.#...####.
#.#..#...#
#.#...#.##
#...#.#.#.
......#..#
#.........
....#.....
.##..####.'''





# s = '''Tile 2311:
# ..##.#..#.
# ##..#.....
# #...##..#.
# ####.#...#
# ##.##.###.
# ##...#.###
# .#.#.#..##
# ..#....#..
# ###...#.#.
# ..###..###

# Tile 1951:
# #.##...##.
# #.####...#
# .....#..##
# #...######
# .##.#....#
# .###.#####
# ###.##.##.
# .###....#.
# ..#.#..#.#
# #...##.#..

# Tile 1171:
# ####...##.
# #..##.#..#
# ##.#..#.#.
# .###.####.
# ..###.####
# .##....##.
# .#...####.
# #.##.####.
# ####..#...
# .....##...

# Tile 1427:
# ###.##.#..
# .#..#.##..
# .#.##.#..#
# #.#.#.##.#
# ....#...##
# ...##..##.
# ...#.#####
# .#.####.#.
# ..#..###.#
# ..##.#..#.

# Tile 1489:
# ##.#.#....
# ..##...#..
# .##..##...
# ..#...#...
# #####...#.
# #..#.#.#.#
# ...#.#.#..
# ##.#...##.
# ..##.##.##
# ###.##.#..

# Tile 2473:
# #....####.
# #..#.##...
# #.##..#...
# ######.#.#
# .#...#.#.#
# .#########
# .###.#..#.
# ########.#
# ##...##.#.
# ..###.#.#.

# Tile 2971:
# ..#.#....#
# #...###...
# #.#.###...
# ##.##..#..
# .#####..##
# .#..####.#
# #..#.#..#.
# ..####.###
# ..#.#.###.
# ...#.#.#.#

# Tile 2729:
# ...#.#.#.#
# ####.#....
# ..#.#.....
# ....#..#.#
# .##..##.#.
# .#.####...
# ####.#.#..
# ##.####...
# ##..#.##..
# #.##...##.

# Tile 3079:
# #.#.#####.
# .#..######
# ..#.......
# ######....
# ####.#..#.
# .#...#.##.
# #.#####.##
# ..#.###...
# ..#.......
# ..#.###...'''

import math
import numpy as np

l = s.split("\n\n")

tile_dict = {}
edge_dict = {}
names = []
for image in l:
    rows = image.splitlines()
    name = rows[0][5:-1]
    
    tile_dict[name] = np.array([[c for c in row] for row in rows[1:]])

    top = []
    left = []
    right = []
    bottom = []

    for i,row in enumerate(rows[1:]):
        for j,char in enumerate(row):
            if i == 0:
                top.append(char)
            if i == len(rows)-2:
                bottom.append(char)
            if j == 0:
                left.append(char)
            if j == len(row)-1:
                right.append(char)

    names.append(name)
    edge_dict[name] = [top,right,bottom,left]

def check_match(n1,n2):
    for i,e1 in enumerate(edge_dict[n1], start=1):
        for j,e2 in enumerate(edge_dict[n2], start=1):
            if e1 == e2:
                return (i,j)
            elif e1 == list(reversed(e2)):
                return (i,-j)
    return None

names.sort()
match_dict = {n:[] for n in names}

for i,n1 in enumerate(names):
    for j,n2 in enumerate(names[i+1:]):
        val = check_match(n1,n2)
        if val is not None:
            match_dict[n1].append((n2,val))
            match_dict[n2].append((n1,val))

corners = []
product = 1
for k in sorted(match_dict.keys()):
    # print(k, len(match_dict[k]))
    if len(match_dict[k]) == 2:
        print(k)
        corners.append(k)
        product *= int(k)
print("Part 1:")
print(product)
print()


def get_matched_sides(tile, match_dict):
    sides = []
    for match in match_dict[tile]:
        if tile < match[0]:
            sides.append(match[1][0])
        else:
            sides.append(match[1][1])
    return sorted(sides)

def get_matching_names(tile, match_dict):
    return set(x[0] for x in match_dict[tile])

def get_rotations(image_array):
    rotations = []
    for i in range(4):
        x = np.rot90(image_array,i)
        y = np.fliplr(x)
        rotations.append(x)
        rotations.append(y)
    return rotations

def get_edge(image_array, side):
    if side == "r":
        return image_array[:,-1]
    elif side == "l":
        return image_array[:,0]
    elif side == "t":
        return image_array[0,:]
    elif side == "b":
        return image_array[-1,:]
    else:
        raise NotImplementedError

def opp_side(side):
    if side == "r":
        return "l"
    elif side == "l":
        return "r"
    elif side == "t":
        return "b"
    elif side == "b":
        return "t"
    else:
        raise NotImplementedError

def find_match(tile, side, options):
    edge = get_edge(tile_dict[tile], side)

    # print('find_match')
    # print(tile)
    for o in options:
        # print(o)
        for r in get_rotations(tile_dict[o]):
            r_edge = get_edge(r,opp_side(side))
            # print(edge,r_edge)
            if np.array_equal(edge,r_edge):
                return o, r
    
    raise NotImplementedError

monster = '''                  # 
#    ##    ##    ###
 #  #  #  #  #  #   '''

monster_coords = []
for y,r in enumerate(monster.splitlines()):
    for x,c in enumerate(r):
        if c == "#":
            monster_coords.append((x,y))

print(monster_coords)

def check_monster(image):
    y,x = image.shape
    if x < 20 or y < 3:
        return 0
    if all(image[y,x] == "#" for x,y in monster_coords):
        return 1
    return 0

def print_image(image):
    for r in image:
        print("".join(r))

# Orient first corner tile to bottom left corner (matches on top / right)
sides = get_matched_sides(corners[0],match_dict)

if sides == [2,3]:
    tile_dict[corners[0]] = np.rot90(tile_dict[corners[0]])
elif sides == [3,4]:
    tile_dict[corners[0]] = np.rot90(tile_dict[corners[0]],2)
elif sides == [1,4]:
    tile_dict[corners[0]] = np.rot90(tile_dict[corners[0]],-1)


dim = int(math.sqrt(len(l)))
placed = set()
rows = []

# Match bottom row left to right
curr = corners[0]
placed.add(corners[0])
row = [corners[0]]

for i in range(dim-1):
    options = get_matching_names(curr, match_dict).difference(placed)
    name, tile = find_match(curr, "r", options)
    tile_dict[name] = tile
    placed.add(name)
    row.append(name)
    curr = name

rows.append(row)
print(row)

# Match rows bottom to top
for r in range(dim-1):
    row = []
    for i,c in enumerate(range(dim)):
        curr = rows[-1][i]
        options = get_matching_names(curr, match_dict).difference(placed)
        name, tile = find_match(curr, "t", options)
        tile_dict[name] = tile
        placed.add(name)
        row.append(name)
    rows.append(row)

rows.reverse()
print(rows)

#Consolidate image and remove borders
image_rows = []
for r in rows:
    x = np.concatenate([tile_dict[x] for x in r],axis=1)
    image_rows.append(x)
image = np.concatenate(image_rows,axis=0)

y,x = image.shape
ys = [i for i in range(image.shape[0]) if i % 10 == 0 or i % 10 == 9]
xs = [i for i in range(image.shape[1]) if i % 10 == 0 or i % 10 == 9]

image = np.delete(image,ys,axis=0)
image = np.delete(image,xs,axis=1)

print(image.shape)
# print_image(image)
hashes = (image == "#").sum()
print(hashes, "total hashes")

for r in get_rotations(image):
    print("***")
    # print_image(r)

    y,x = r.shape
    count = 0
    for i in range(y):
        for j in range(x):
            result = check_monster(r[i:,j:])
            count += result
            if result > 0:
                print(i,j)
    if count > 0:
        print()
        print("Part 2:")
        print(count, "monsters", 15*count, "monster hashes", hashes - 15*count, "non monster hashes")
        print()





